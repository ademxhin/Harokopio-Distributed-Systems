<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base}">

<th:block layout:fragment="head">
    <title>GreenRide | Profile</title>
    <link rel="stylesheet" th:href="@{/css/profile.css}">
</th:block>

<main layout:fragment="main" class="gr-profile-page">
    <div class="container gr-profile-layout">

        <!-- SIDEBAR -->
        <aside class="gr-side">
            <div class="gr-side-user">
                <div class="gr-side-avatar">
                    <span th:text="${#strings.substring(fullName,0,1)}">A</span>
                </div>

                <div class="gr-side-user-meta">
                    <div class="gr-side-user-name" th:text="${fullName}">User</div>
                    <div class="gr-side-user-email" th:text="${emailAddress}">user@mail.com</div>
                </div>
            </div>

            <nav class="gr-side-nav">
                <a class="gr-side-link"
                   th:classappend="${activeTab == 'home'} ? ' is-active' : ''"
                   th:href="@{/profile(tab='home')}">Home</a>

                <a class="gr-side-link"
                   th:classappend="${activeTab == 'personal'} ? ' is-active' : ''"
                   th:href="@{/profile(tab='personal')}">Personal info</a>
            </nav>
        </aside>

        <!-- CONTENT -->
        <section class="gr-content">

            <!-- HOME TAB -->
            <th:block th:if="${activeTab == 'home'}">

                <header class="gr-content-header">
                    <h1 class="gr-h1"
                        th:text="${isAdmin ? 'Administrator Dashboard' : 'Home'}">Home</h1>

                    <p class="gr-sub"
                       th:text="${isAdmin ? 'Platform overview and moderation tools.' : 'Quick actions based on your role.'}">
                        Quick actions based on your role.
                    </p>

                    <div class="gr-header-divider"></div>
                </header>

                <!-- ACTIONS -->
                <div class="gr-actions-grid">

                    <div class="gr-action-card" th:if="${driverEnabled}">
                        <div class="gr-action-title">Create ride</div>
                        <div class="gr-action-sub">Create a new ride with origin, destination, time and available seats.</div>
                        <a class="gr-action-link" th:href="@{/rides/offer}">Continue →</a>
                    </div>

                    <div class="gr-action-card" th:if="${passengerEnabled}">
                        <div class="gr-action-title">Search rides</div>
                        <div class="gr-action-sub">Browse available rides and request a seat.</div>
                        <a class="gr-action-link" th:href="@{/rides/search}">Continue →</a>
                    </div>

                    <div class="gr-action-card" th:if="${passengerEnabled}">
                        <div class="gr-action-title">My bookings</div>
                        <div class="gr-action-sub">View your bookings, cancel a request, and track status.</div>
                        <a class="gr-action-link" th:href="@{/rides/bookings}">Continue →</a>
                    </div>

                    <div class="gr-action-card" th:if="${passengerEnabled}">
                        <div class="gr-action-title">My Ride History</div>
                        <div class="gr-action-sub">View rides you have joined as a passenger.</div>
                        <a class="gr-action-link" th:href="@{/rides/history/passenger}">Continue →</a>
                    </div>

                    <div class="gr-action-card" th:if="${passengerEnabled}">
                        <div class="gr-action-title">Rate Drivers</div>
                        <div class="gr-action-sub">Rate drivers after completing a ride.</div>
                        <a class="gr-action-link" th:href="@{/rides/ratings/passenger}">Continue →</a>
                    </div>

                    <div class="gr-action-card" th:if="${driverEnabled}">
                        <div class="gr-action-title">My Offered Rides</div>
                        <div class="gr-action-sub">Manage your upcoming rides (edit, cancel, view passengers).</div>
                        <a class="gr-action-link" th:href="@{/rides/offered}">Continue →</a>
                    </div>

                    <div class="gr-action-card" th:if="${driverEnabled}">
                        <div class="gr-action-title">Ride History</div>
                        <div class="gr-action-sub">View rides you have completed as a driver.</div>
                        <a class="gr-action-link" th:href="@{/rides/history/driver}">Continue →</a>
                    </div>

                    <div class="gr-action-card" th:if="${driverEnabled}">
                        <div class="gr-action-title">Rate Passengers</div>
                        <div class="gr-action-sub">Rate passengers after a completed ride.</div>
                        <a class="gr-action-link" th:href="@{/rides/ratings/driver}">Continue →</a>
                    </div>
                </div>

                <!-- ADMIN -->
                <th:block th:if="${isAdmin}">

                    <div class="gr-admin-sep"></div>

                    <div class="gr-actions-grid gr-admin-grid">

                        <div class="gr-action-card">
                            <div class="gr-action-title">System Statistics</div>

                            <div class="gr-action-sub gr-sub-compact">
                                <div class="gr-kv">Total rides: <strong th:text="${stats.totalRides}">0</strong></div>

                                <!-- REQUIRED BY BRIEF: average occupancy -->
                                <div class="gr-kv">
                                    Average occupancy:
                                    <strong th:text="${stats.averageOccupancyPctRounded} + '%'">0%</strong>
                                </div>

                                <div class="gr-kv">Active drivers: <strong th:text="${stats.activeDrivers}">0</strong></div>
                                <div class="gr-kv">Active passengers: <strong th:text="${stats.activePassengers}">0</strong></div>
                            </div>
                        </div>

                        <div class="gr-action-card">
                            <div class="gr-action-title">Flagged Users</div>

                            <div th:if="${#lists.isEmpty(kickedUserNames)}" class="gr-action-sub gr-sub-compact">
                                No flagged users found.
                            </div>

                            <ul th:if="${!#lists.isEmpty(kickedUserNames)}" class="gr-plain-list">
                                <li th:each="name : ${kickedUserNames}" th:text="${name}">User Name</li>
                            </ul>
                        </div>
                    </div>

                    <div class="gr-card gr-mt-14">
                        <div class="gr-card-pad">
                            <div class="gr-section-title gr-mb-6">User Management</div>
                            <div class="gr-section-sub">Kick users (removes rides/bookings).</div>

                            <div class="gr-table-wrap gr-mt-12">
                                <table class="gr-table">
                                    <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Status</th>
                                        <th style="width:140px;">Actions</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="u : ${allUsers}">
                                        <td th:text="${u.fullName}" class="gr-fw-800">User Name</td>
                                        <td th:text="${u.emailAddress}">email@example.com</td>
                                        <td>
                                            <span class="gr-badge gr-badge-danger"
                                                  th:if="${kickedUserNames != null and kickedUserNames.contains(u.fullName)}">Flagged</span>
                                            <span class="gr-badge gr-badge-success"
                                                  th:if="${kickedUserNames == null or !kickedUserNames.contains(u.fullName)}">Active</span>
                                        </td>
                                        <td>
                                            <a th:href="@{'/admin/kick/' + ${u.id}}"
                                               class="gr-btn gr-btn-danger gr-btn-sm"
                                               onclick="return confirm('Kick this user? This will also remove their rides/bookings.');">
                                                Kick
                                            </a>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>

                </th:block>
            </th:block>

            <!-- PERSONAL TAB -->
            <th:block th:if="${activeTab == 'personal'}">
                <header class="gr-content-header">
                    <h1 class="gr-h1">Personal info</h1>
                    <p class="gr-sub">Your personal account information.</p>
                    <div class="gr-header-divider"></div>
                </header>

                <div class="gr-card">
                    <div class="gr-card-top">
                        <div class="gr-avatar">
                            <span class="gr-avatar-initials"
                                  th:text="${#strings.substring(fullName,0,1)}">U</span>
                        </div>

                        <div class="gr-card-meta">
                            <div class="gr-meta-name" th:text="${fullName}">User</div>
                            <div class="gr-meta-sub" th:text="${emailAddress}">user@mail.com</div>
                        </div>
                    </div>

                    <div class="gr-divider"></div>

                    <div class="gr-rows">
                        <div class="gr-row gr-row-static">
                            <div class="gr-row-left">
                                <div class="gr-row-label">Name</div>
                                <div class="gr-row-value" th:text="${fullName}">User</div>
                            </div>
                            <div class="gr-row-right gr-muted">•</div>
                        </div>

                        <div class="gr-row gr-row-static">
                            <div class="gr-row-left">
                                <div class="gr-row-label">Phone number</div>
                                <div class="gr-row-value" th:text="${mobilePhoneNumber}">—</div>
                            </div>
                            <div class="gr-row-right gr-muted">•</div>
                        </div>

                        <div class="gr-row gr-row-static">
                            <div class="gr-row-left">
                                <div class="gr-row-label">Email</div>
                                <div class="gr-row-value" th:text="${emailAddress}">user@mail.com</div>
                            </div>
                            <div class="gr-row-right gr-muted">•</div>
                        </div>

                        <div class="gr-row gr-row-static">
                            <div class="gr-row-left">
                                <div class="gr-row-label">Role</div>
                                <div class="gr-row-value" th:text="${roleLabel}">Passenger</div>
                            </div>
                            <div class="gr-row-right gr-muted">•</div>
                        </div>
                    </div>
                </div>
            </th:block>

        </section>
    </div>
</main>
</html>